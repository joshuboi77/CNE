# CNE Conceptual Physics — Engineering Specification (Mathematical)

Author: CNE Research
Status: Active (PPMI + NN pipeline primary); legacy physics path archived under `legacy/`

## 0. Scope
This document specifies the mathematical definitions, transformations, models, and classification rules used by the CNE (Conceptual‑Neural Engine) to build concept representations and phases (collapsed · event horizon · stable) from raw text corpora. It covers both the current PPMI+NN pipeline and the legacy energy‑gated path for reference.

Notation: all scalars are lower‑case; vectors bold; matrices uppercase.

---

## 1. Corpus and Co‑occurrence

- Tokens: words w ∈ V extracted from a corpus; whitespace/punctuation segmentation; lower‑cased.
- Windowed co‑occurrence: symmetric sliding window size W (default 5). For each position t with center c_t, count pairs (c_t, n) for tokens n within ±W, n ≠ c_t.

Counts
- N: total number of windowed co‑occurrence events (after symmetry).
- N(w): total co‑occurrence count for word w (sum over its pairs).
- N(w, x): co‑occurrence count for pair (w, x) (symmetric, N(w, x) = N(x, w)).

PPMI (Positive Pointwise Mutual Information)
- PMI(w, x) = log((N · N(w, x)) / (N(w) · N(x))).
- PPMI(w, x) = max(0, PMI(w, x)).
- Top‑K: for each w, keep K highest PPMI neighbors x (default K = 256).

Soft‑clipped neighbor weights
- For neighbor list {(x_i, p_i)} with p_i = PPMI(w, x_i), define weights:
  w_i = log(1 + p_i).

Mass of a concept (shape‑based)
- m_w = Σ_i p_i (sum of PPMI values over top‑K neighbors).

Average PPMI (semantic radius proxy)
- p̄_w = (1/K) · Σ_i p_i (mean of neighbor PPMIs) computed over non‑empty neighbor list.

---

## 2. Embeddings

Two interchangeable sources:
1) Deterministic hash embeddings (dimension d):
   - e(tok) ∈ ℝ^d generated by a seeded hash → Normal(0, σ^2), then L2‑normalized.
2) Trained embeddings (dimension d):
   - Vocabulary index ι: V → {0…|V|−1}.
   - Initialize E ∈ ℝ^{|V|×d} with small random vectors normalized row‑wise.
   - Neighbor‑smoothing training (epochs T, step size η): for each token w,
     - Target neighborhood mean in embedding space:
       μ_w = (Σ_i w_i · E[ι(x_i)]) / (Σ_i w_i + ε)
     - Update (row‑wise, followed by normalization):
       E[ι(w)] ← (1 − η) · E[ι(w)] + η · μ_w;  E[ι(w)] ← E[ι(w)] / ||E[ι(w)]||_2.

---

## 3. Concept Projector (Tiny MLP)

Given the neighbor‑weighted embedding centroid for token w:
- x_w = (Σ_i w_i · e(x_i)) / (Σ_i w_i + ε)  ∈ ℝ^d

Projector (tanh MLP)
- Hidden: h = tanh(W₁ x_w + b₁), W₁ ∈ ℝ^{h×d}, b₁ ∈ ℝ^h.
- Output: y = W₂ h + b₂, W₂ ∈ ℝ^{(d+1)×h}, b₂ ∈ ℝ^{d+1}.
- Decompose: center c_w = y[:d] ∈ ℝ^d; log_spread ℓ_w = y[d] ∈ ℝ.
- Spread: s_w = exp(ℓ_w) ∈ ℝ⁺.

Training objective (self‑supervised)
- Center target: μ_w (neighbor centroid); variance target:
  v_w = mean_i ||e(x_i) − μ_w||².
- Loss per token:
  L_w = ||c_w − μ_w||² + (exp(ℓ_w) − v_w)²  (+ optional weight decay/regularizers).

---

## 4. Stability

- Stability (diagnostic scalar):  S_w = m_w / (s_w + ε).
Note: this scalar is not used for phase classification in the current pipeline; phases are derived from φ bands (Section 6). We keep S_w as a descriptive “binding” magnitude.

---

## 5. Expected PPMI vs. Mass (Lifecycle Baseline)

Fit the conditional expectation of average PPMI given mass:
- Let z_w = ln(m_w + 1).
- Regress p̄_w on z_w with a quadratic (least‑squares polyfit):
  E[p̄|m](w) = α₂ z_w² + α₁ z_w + α₀.
- The fit parameters (α₂, α₁, α₀) are persisted for reproducibility.

Median spread (corpus constant)
- s* = median_w s_w.

---

## 6. Residual‑Aware Schwarzschild Overlay (Primary Phase Rule)

Residual (shape deviation)
- r_w = p̄_w − E[p̄|m](w).

Schwarzschild radius (collapse threshold)
- R_s(w) = (a + b · ln(m_w + 1)) · (s_w / s*)^γ · [1 − tanh(κ · r_w)].
  - a = 2.1, b = 0.52, γ = 0.25, κ = 0.6 (defaults calibrated empirically).

Event‑horizon ratio
- φ_w = p̄_w / R_s(w).

Phase classification (banded φ)
- collapsed       if  φ_w < 1 − δ
- event_horizon   if  |φ_w − 1| ≤ δ
- stable          if  φ_w > 1 + δ
- Band width δ: default 0.15; see §7 for calibration.

Persist per token: (rs=R_s, phi=φ, avg_ppmi=p̄, phase).

---

## 7. Event‑Horizon Band Calibration (Optional)

Goal: choose δ to target desired EH proportion ρ* (e.g., 0.148).
- Let Φ = {φ_w} over tokens with neighbors.
- Define density function D(δ) = |{w: |φ_w − 1| ≤ δ}| / |Φ|.
- Choose δ* = argmin_δ |D(δ) − ρ*| over a monotone grid δ ∈ [δ_min, δ_max] (e.g., [0.05, 0.35] in small steps).
- Persist δ* alongside (a,b,γ,κ, s*, α₂,α₁,α₀) in summary/meta.

---

## 8. Database Model (Concepts Store)

Schema (SQLite)
- concepts(token PRIMARY KEY,
  center_json TEXT, spread REAL, mass REAL,
  stability REAL, phase TEXT,
  rs REAL, phi REAL, avg_ppmi REAL)
- ppmi_neighbors(token, neighbor, ppmi, rank, PRIMARY KEY(token,neighbor))
- meta(key PRIMARY KEY, value TEXT)

Recommended indices
- CREATE INDEX IF NOT EXISTS idx_phase ON concepts(phase);
- CREATE INDEX IF NOT EXISTS idx_stability ON concepts(stability);
- CREATE INDEX IF NOT EXISTS idx_phi ON concepts(phi);

---

